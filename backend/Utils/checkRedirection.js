const command = require('./command');

const redirects = (url) => {
    return new Promise((resolve, reject) => {
        console.log('Checking for redirection for URL: ' + url);
        command.execCommand('curl -v -L ' + url + ' 2>&1 | egrep "^< (Location:)" | tail -1; echo "";', 'redirect')
            .then((commandOutput) => {
                if (commandOutput.includes('Location:')) {
                    const redirectUrl = commandOutput.split('Location: ')[1];
                    resolve({'redirect': true, 'redirectUrl': redirectUrl});
                    console.log('Redirected to: ' + redirectUrl);
                } else {
                    resolve({'redirect': false})
                    console.log('No redirection');
                }
            })
            .catch((err) => {
                reject(err);
            });
    });
}

module.exports = {
    redirects: async (url) => {
        return await redirects(url);
    }
};