const command = require('./command');

const normalScan = (url) => {
    return new Promise((resolve, reject) => {
        command.execCommand('wpscan --url ' + url + ' -f json -o outputs/wpscanOutput; echo "finished"', 'wpscan')
            .then((commandOutput) => {
                if (commandOutput['scan_aborted'] !== undefined) { // the provided url redirects 
                    resolve({'redirect': true, 'redirectUrl': commandOutput['scan_aborted'].split(' ')[5].slice(0, -1)})
                } else {
                    resolve(commandOutput);
                }
                // create an object with the useful info and return
                resolve(commandOutput);
            })
            .catch((err) => {
                reject(err);
            });
    });
};

const bruteforceScan = (url) => {
    return new Promise((resolve, reject) => {
        command.execCommand('wpscan --url ' + url + ' -P /home/localhost/Downloads/passwords.txt -f json -o outputs/wpscanOutput; echo "finished"', 'wpscan')
            .then((commandOutput) => {
                // create an object with the useful info and return
                resolve(commandOutput);
            })
            .catch((err) => {
                reject(err);
            });
    });
};

module.exports = {
    normalScan: async (url) => {
        return await normalScan(url);
    },
    bruteforceScan: async (url) => {
        return await bruteforceScan(url);
    }
};