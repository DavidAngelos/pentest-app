const {exec} = require('child_process');
const nmap2json = require('./processor');

const execCommand = (command, callback) => {
  exec(command, (err, stdout, stderr) => {
    if (err) {
      console.error("Exec error: ", err);
      callback("Command failed: " + command);
      return;
    }

    // the *entire* stdout and stderr (buffered)
    console.log(`stdout: ${stdout}`);
    console.log(`stderr: ${stderr}`);
    if (stderr) {
      callback(stderr);
      return;
    }
    if (stdout) {
      nmap2json.final()
        .then((resolve)=>{
          console.log(resolve);
          callback(resolve);
        })
        .catch((reject) => {
          console.log(reject);
        });
    }
  });
};

module.exports = execCommand;
