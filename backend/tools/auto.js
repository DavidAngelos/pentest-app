const command = require('../Utils/command');
const nmap = require('./nmap');
const whatweb = require('./whatweb');
const wordpress = require('./wordpress');

const autoScan = (url) => {
    return new Promise((resolve, reject) => {
        nmap.defaultNmapScan(url)
            .then((nmapOutput) => {
                const openPorts = nmapOutput['openPorts'];
                if (openPorts.includes('80')) {
                    // continue with whatweb scan
                    console.log(openPorts);
                    whatweb.defaultWhatWebScan(url)
                        .then((whatwebOutput) => {
                            if (Object.keys(whatwebOutput).includes('WordPress')) {
                                const wordpressVersion = whatwebOutput['WordPress']['version'];
                                console.log('Wordpress found with version ' + wordpressVersion);
                                // continue with wpscan scan
                                wordpress.normalScan(url)
                                  .then((wordpressOutput) => {
                                    console.log('Interesting URLs found: ');
                                    wordpressOutput['interesting_findings'].forEach(finding => {
                                      console.log(finding['url']);
                                    });
              
                                    // bruteforce
                                    wordpress.bruteforceScan(url)
                                      .then((wordpressOutput) => {
                                        console.log(wordpressOutput);
                                      });
              
                                  });
                              }
                        })
                }
            })
    });
};


module.exports = {
    autoScan: async (url) => {
        return await autoScan(url);
    }
};