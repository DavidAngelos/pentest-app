const nmap = require('./nmap');
const whatweb = require('./whatweb');
const wordpress = require('./wordpress');
const joomla = require('./joomla');
const whois = require('./whois');
const wapiti = require('./wapiti');

const customScan = (url, toolsSelected) => {
    return new Promise((resolve, reject) => {

        if (toolsSelected.includes('nmap_default')) {
            nmap.nmapTool(url, "default")
                .then((nmapOutput) => { console.log("Nmap default output: " + nmapOutput); })
                .catch(err => reject(err));
        }
        if (toolsSelected.includes('nmap_vuln')) {
            nmap.nmapTool(url, "common")
                .then((nmapOutput) => { console.log("Nmap common vuln output: " + nmapOutput); })
                .catch(err => reject(err));
        }
        if (toolsSelected.includes('theharvester')) {
            whois.whoisTool(url, "default")
                .then((whoisInfo) => console.log("Whois output: " + whoisInfo))
                .catch((err) => reject(err));
        }
        if (toolsSelected.includes('whatweb')) {
            whatweb.whatwebTool(url, "default")
                .then((whatwebInfo) => console.log("Whatweb output: " + whatwebInfo))
                .catch((err) => reject(err));
        }
        if (toolsSelected.includes('wapiti_sqli')) {
            wapiti.wapitiTool(url, "sqli")
                .then((wapitiInfo) => console.log("Wapiti sqli output: " + wapitiInfo))
                .catch((err) => reject(err));
        }
        if (toolsSelected.includes('wapiti_xss')) {
            wapiti.wapitiTool(url, "xss")
                .then((wapitiInfo) => console.log("Wapiti xss output: " + wapitiInfo))
                .catch((err) => reject(err));
        }
        if (toolsSelected.includes('wpscan_default')) {
            wordpress.wordpressTool(url, "default")
                .then((wordpressOutput) => console.log("Wordpress default output: " + wordpressOutput))
                .catch((err) => reject(err))
        }
        if (toolsSelected.includes('joomscan_default')) {
            joomla.joomlaTool(url, "default")
                .then((joomlaInfo) => console.log("Joomla default output: " + joomlaInfo))
                .catch((err) => reject(err));
        }
        if (toolsSelected.includes('wpscan_bruteforce')) {
            wordpress.wordpressTool(url, "bruteforce")
                .then((wordpressOutput) => console.log("Wordpress default output: " + joomlaInfo))
                .catch((err) => reject(err));
        }
        if (toolsSelected.includes('nmap_joomla')) {
            nmap.nmapTool(url, "joomlaBrute")
                .then((nmapOutput) => { console.log("Nmap joomla bruteforce output: " + nmapOutput); })
                .catch(err => rejenmapOutputct(err));
        }
    });
};

function customScanTool(url, toolsSelected) {
    return new Promise((resolve, reject) => {
        customScan(url, toolsSelected)
            .then((commandOutput) => {
                // TODO: Do sth
                resolve(commandOutput);
            })
            .catch((err) => {
                reject(err);
            });
    });
}

module.exports = {
    customScanTool: async (url, toolsSelected) => {
        return await customScanTool(url, toolsSelected);
    }
};