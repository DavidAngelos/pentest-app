const command = require('../Utils/command');
const xml2Json = require('../Utils/xml2Json');
const config = require('../config/config');


const defaultWhoisLookup = (url) => {
    return new Promise((resolve, reject) => {
        command.execCommand(config.THEHARVESTER + ' -d ' + url + ' -l 100 -b google -f outputs/whois.xml', 'whois')
            .then((commandOutput) => {
                resolve(commandOutput);
                // // get open ports 
                // const ports = commandOutput["host"]["ports"];
                // const openPorts = [];
                // ports.forEach(element => {
                //     if (element["state"]["state"] === "open") {
                //         openPorts.push(element["port"]["portid"]);
                //     }
                // });
                // console.log('Nmap scan found these ports as open: ' + openPorts);
                // resolve({ 'openPorts': openPorts })
            })
            .catch((err) => {
                reject(err);
            });
    });
};

function whoisLookup2Json() {
    return new Promise((resolve, reject) => {
        xml2Json.xml2Json()
            .then((json) => {
              console.log('Finshed Convertion whois.');
              resolve(json)
            })
            .catch((err) => {
              console.log(err);
            });
    });
}

module.exports = {
    defaultWhoisLookup: async (url) => {
        return await defaultWhoisLookup(url);
    },
    whoisLookup2Json: async () => {
        return await whoisLookup2Json();
    }
};